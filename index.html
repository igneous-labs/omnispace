<!DOCTYPE html>
<html lang="en">
  <head>
    <script defer src="lib/matrix.js"></script>
    <script defer src="consts.js"></script>
    <script defer src="minimalTest.js"></script>
    <script
      src="viewportHax.js"
      defer
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- <script defer src="gameComm.js"></script> -->
    <script
      type="module"
      src="https://unpkg.com/canvas-txt@3.0.0/build/index.js"
    ></script>
    <script defer src="game.js"></script>

    <title>Test</title>
    <meta charset="utf-8" />
    <link rel="icon" href="data:," />
    <link href="styles/style.css" rel="stylesheet" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1 maximum-scale=1"
    />
    <link rel="manifest" href="omnispace.webmanifest" />
    <script src="/characterCustomizer.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
      defer
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"
      defer
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <link href="/dist/output.css" rel="stylesheet" />
  </head>
  <!-- overflow-y-hidden doesnt work with safari -->
  <body class="overflow-hidden">
    <nav
      class="flex flex-wrap justify-between items-center px-4 py-2 gap-2 sticky top-0"
    >
      <button
        onClick="setActiveRoom(null); render();"
        class="rounded-md border border-transparent bg-slate-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2"
      >
        Back
      </button>
      <h1 id="title" class="text-xl font-bold mx-auto">Omnispace</h1>
      <button
        onClick="logout()"
        class="rounded-md border border-transparent bg-slate-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2"
      >
        Logout
      </button>

      <!-- Start customize character sidebar -->
      <div
        x-data="{
          characterMenuOpen: false,
          isSaving: false,
          async saveCharacter(selectors) {
            if (this.isSaving) return;
            this.isSaving = true;
            try {
              await characterSaver(selectors)
            } catch(err) {
              alert(err.message)
            } finally {
              this.isSaving = false;
            }
          },
          closeCharacterMenu() {
            if (this.isSaving) return;
            this.characterMenuOpen = false;
          }
        }"
      >
        <button
          @click="characterMenuOpen = true"
          class="rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        >
          Customize character
        </button>

        <div
          @keydown.window.escape="closeCharacterMenu()"
          x-show="characterMenuOpen"
          class="relative z-10"
          aria-labelledby="slide-over-title"
          x-ref="dialog"
          aria-modal="true"
        >
          <div
            x-description="Background backdrop, show/hide based on slide-over state."
            class="fixed inset-0"
          ></div>

          <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
              <div
                class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full sm:pl-10"
              >
                <div
                  x-show="characterMenuOpen"
                  x-transition:enter="transform transition ease-in-out duration-500 sm:duration-700"
                  x-transition:enter-start="translate-x-full"
                  x-transition:enter-end="translate-x-0"
                  x-transition:leave="transform transition ease-in-out duration-500 sm:duration-700"
                  x-transition:leave-start="translate-x-0"
                  x-transition:leave-end="translate-x-full"
                  class="pointer-events-auto w-screen max-w-md"
                  x-description="Slide-over panel, show/hide based on slide-over state."
                  @click.away="closeCharacterMenu()"
                >
                  <div
                    class="flex h-full flex-col divide-y divide-gray-200 bg-white shadow-xl"
                    x-data="menuData"
                  >
                    <div
                      class="flex min-h-0 flex-1 flex-col overflow-y-scroll py-6"
                    >
                      <div class="px-4 sm:px-6">
                        <div class="flex items-start justify-between">
                          <h2
                            class="text-lg font-medium text-gray-900"
                            id="slide-over-title"
                          >
                            Customize character
                          </h2>
                          <div class="ml-3 flex h-7 items-center">
                            <button
                              type="button"
                              class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                              @click="closeCharacterMenu()"
                              :disabled="isSaving"
                            >
                              <span class="sr-only">Close panel</span>
                              <svg
                                class="h-6 w-6"
                                x-description="Heroicon name: outline/x-mark"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                aria-hidden="true"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M6 18L18 6M6 6l12 12"
                                ></path>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Start character customizer content -->
                      <div
                        class="relative mt-6 flex-1 px-4 sm:px-6 space-y-4"
                        x-data="characterOptions"
                      >
                        <!-- Start character preview -->
                        <div
                          class="flex items-center justify-center sticky z-10 bg-white h-44 -top-6 border-dashed border-2 border-gray-300"
                          x-init="fetchCharacterPreview()"
                        >
                          <template x-if="characterPreview">
                            <img
                              class="h-28 pixel"
                              alt="Character preview"
                              :src="`${characterPreview}`"
                            />
                          </template>
                        </div>
                        <!-- End character preview -->

                        <!-- Start selectors -->
                        <div
                          class="space-y-4"
                          x-data="{
                            itemsPerPage: 1000
                          }"
                        >
                          <!-- Start character selector -->
                          <div>
                            <p class="text-lg font-bold">Character</p>

                            <div
                              class="grid grid-cols-2 gap-4 bg-slate-300 p-4 rounded-md"
                            >
                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="skin"
                                    class="block text-md font-medium text-slate-800"
                                    >Skin</label
                                  >

                                  <template
                                    x-if="selectors.skin !== defaultSelectors.skin"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('skin')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <select
                                  id="skin"
                                  name="skin"
                                  class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm cursor-pointer"
                                  x-model="selectors.skin"
                                  x-on:change="fetchCharacterPreview()"
                                >
                                  <template
                                    x-for="skin in characterOptions.skins"
                                    :key="skin.value"
                                  >
                                    <option
                                      x-text="skin.label"
                                      :value="skin.value"
                                      :selected="skin.value === selectors.skin"
                                    ></option>
                                  </template>
                                </select>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="expression"
                                    class="block text-md font-medium text-slate-800"
                                    >Expression</label
                                  >

                                  <template
                                    x-if="selectors.expression !== defaultSelectors.expression"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('expression')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <select
                                  id="expression"
                                  name="expression"
                                  class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm cursor-pointer"
                                  x-model="selectors.expression"
                                  x-on:change="fetchCharacterPreview()"
                                >
                                  <template
                                    x-for="expression in characterOptions.expressions"
                                    :key="expression.value"
                                  >
                                    <option
                                      x-text="expression.label"
                                      :value="expression.value"
                                      :selected="expression.value === selectors.expression"
                                    ></option>
                                  </template>
                                </select>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="ears"
                                    class="block text-md font-medium text-slate-800"
                                    >Ears</label
                                  >

                                  <template
                                    x-if="selectors.ears !== defaultSelectors.ears"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('ears')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <select
                                  id="ears"
                                  name="ears"
                                  class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm cursor-pointer"
                                  x-model="selectors.ears"
                                  x-on:change="fetchCharacterPreview()"
                                >
                                  <template
                                    x-for="ear in characterOptions.ears"
                                    :key="ear.value"
                                  >
                                    <option
                                      x-text="ear.label"
                                      :value="ear.value"
                                      :selected="ear.value === selectors.ears"
                                    ></option>
                                  </template>
                                </select>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="hair"
                                    class="block text-md font-medium text-slate-800"
                                    >Hair</label
                                  >

                                  <template
                                    x-if="selectors.hair.hairId !== defaultSelectors.hair.hairId"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('hair')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.hairs && Math.ceil(this.hairs.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const hairsEl = document.getElementById('hairs')
                                    hairsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const hairsEl = document.getElementById('hairs')
                                    hairsEl.scrollTo(0, 0)
                                  },
                                  get currentPageHairs() {
                                    if (!this.hairs) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.hairs.slice(start, end)
                                  },
                                  hairs: null,
                                  isLoading: false,
                                  async fetchHair() {
                                    if (this.hairs || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/hair.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.hairs = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchHair()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.hair.name"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading hair...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="hairs"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="hair in currentPageHairs"
                                              :key="hair.hairId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.hair = hair; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/hair/${hair.hairId}/icon`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="face"
                                    class="block text-md font-medium text-slate-800"
                                    >Face</label
                                  >

                                  <template
                                    x-if="selectors.face.faceId !== defaultSelectors.face.faceId"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('face')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.faces && Math.ceil(this.faces.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const facesEl = document.getElementById('faces')
                                    facesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const facesEl = document.getElementById('faces')
                                    facesEl.scrollTo(0, 0)
                                  },
                                  get currentPageFaces() {
                                    if (!this.faces) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.faces.slice(start, end)
                                  },
                                  faces: null,
                                  isLoading: false,
                                  async fetchFaces() {
                                    if (this.faces || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/faces.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.faces = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchFaces()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.face.name"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading faces...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div>
                                            <div
                                              id="faces"
                                              class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                            >
                                              <template
                                                x-for="face in currentPageFaces"
                                                :key="face.faceId"
                                              >
                                                <div
                                                  class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                  @click="selectors.face = face; fetchCharacterPreview();"
                                                >
                                                  <img
                                                    crossorigin="anonymous"
                                                    :src="`https://api.maplestory.net/face/${face.faceId}/icon`"
                                                    loading="lazy"
                                                  />
                                                </div>
                                              </template>
                                            </div>

                                            <nav
                                              class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                            >
                                              <div
                                                class="-mt-px flex w-0 flex-1"
                                              >
                                                <button
                                                  class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                                  @click="previousPage()"
                                                  :disabled="!hasPreviousPage"
                                                >
                                                  <svg
                                                    class="mr-3 h-5 w-5 text-gray-400"
                                                    x-description="Heroicon name: mini/arrow-long-left"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                    aria-hidden="true"
                                                  >
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                      clip-rule="evenodd"
                                                    ></path>
                                                  </svg>
                                                  Previous
                                                </button>
                                              </div>
                                              <div class="flex -mt-px">
                                                <p
                                                  class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                                  aria-current="page"
                                                  x-text="page + 1"
                                                ></p>
                                              </div>
                                              <div
                                                class="-mt-px flex w-0 flex-1 justify-end"
                                              >
                                                <button
                                                  class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                                  @click="nextPage()"
                                                  :disabled="!hasNextPage"
                                                >
                                                  Next
                                                  <svg
                                                    class="ml-3 h-5 w-5 text-gray-400"
                                                    x-description="Heroicon name: mini/arrow-long-right"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                    aria-hidden="true"
                                                  >
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                      clip-rule="evenodd"
                                                    ></path>
                                                  </svg>
                                                </button>
                                              </div>
                                            </nav>
                                          </div>
                                        </template>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- End character selector -->

                          <!-- Start Accessories selector -->
                          <div>
                            <p class="text-lg font-bold">Accessories</p>

                            <div
                              class="grid grid-cols-2 gap-4 bg-slate-300 p-4 rounded-md"
                            >
                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="faceAccessory"
                                    class="block text-md font-medium text-slate-800"
                                    >Face accessory</label
                                  >

                                  <template
                                    x-if="selectors.faceAccessory !== defaultSelectors.faceAccessory"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('faceAccessory')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.faceAccessories && Math.ceil(this.faceAccessories.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const faceAccessoriesEl = document.getElementById('faceAccessories')
                                    faceAccessoriesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const faceAccessoriesEl = document.getElementById('faceAccessories')
                                    faceAccessoriesEl.scrollTo(0, 0)
                                  },
                                  get currentPageFaceAccessories() {
                                    if (!this.faceAccessories) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.faceAccessories.slice(start, end)
                                  },
                                  faceAccessories: null,
                                  isLoading: false,
                                  async fetchFaceAccessories() {
                                    if (this.faceAccessories || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/faceAccessories.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.faceAccessories = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchFaceAccessories()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.faceAccessory && selectors.faceAccessory.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading face accessories...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div>
                                            <div
                                              id="faceAccessories"
                                              class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                            >
                                              <template
                                                x-for="faceAccessory in currentPageFaceAccessories"
                                                :key="faceAccessory.itemId"
                                              >
                                                <div
                                                  class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                  @click="selectors.faceAccessory = faceAccessory; fetchCharacterPreview();"
                                                >
                                                  <img
                                                    crossorigin="anonymous"
                                                    :src="`https://api.maplestory.net/item/${faceAccessory.itemId}/iconRaw`"
                                                    loading="lazy"
                                                  />
                                                </div>
                                              </template>
                                            </div>

                                            <nav
                                              class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                            >
                                              <div
                                                class="-mt-px flex w-0 flex-1"
                                              >
                                                <button
                                                  class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                                  @click="previousPage()"
                                                  :disabled="!hasPreviousPage"
                                                >
                                                  <svg
                                                    class="mr-3 h-5 w-5 text-gray-400"
                                                    x-description="Heroicon name: mini/arrow-long-left"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                    aria-hidden="true"
                                                  >
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                      clip-rule="evenodd"
                                                    ></path>
                                                  </svg>
                                                  Previous
                                                </button>
                                              </div>
                                              <div class="flex -mt-px">
                                                <p
                                                  class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                                  aria-current="page"
                                                  x-text="page + 1"
                                                ></p>
                                              </div>
                                              <div
                                                class="-mt-px flex w-0 flex-1 justify-end"
                                              >
                                                <button
                                                  class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                                  @click="nextPage()"
                                                  :disabled="!hasNextPage"
                                                >
                                                  Next
                                                  <svg
                                                    class="ml-3 h-5 w-5 text-gray-400"
                                                    x-description="Heroicon name: mini/arrow-long-right"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                    aria-hidden="true"
                                                  >
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                      clip-rule="evenodd"
                                                    ></path>
                                                  </svg>
                                                </button>
                                              </div>
                                            </nav>
                                          </div>
                                        </template>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="eyeAccessory"
                                    class="block text-md font-medium text-slate-800"
                                    >Eye accessory</label
                                  >

                                  <template
                                    x-if="selectors.eyeAccessory !== defaultSelectors.eyeAccessory"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('eyeAccessory')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.eyeAccessories && Math.ceil(this.eyeAccessories.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const eyeAccessoriesEl = document.getElementById('eyeAccessories')
                                    eyeAccessoriesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const eyeAccessoriesEl = document.getElementById('eyeAccessories')
                                    eyeAccessoriesEl.scrollTo(0, 0)
                                  },
                                  get currentPageEyeAccessories() {
                                    if (!this.eyeAccessories) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.eyeAccessories.slice(start, end)
                                  },
                                  eyeAccessories: null,
                                  isLoading: false,
                                  async fetchEyeAccessories() {
                                    if (this.eyeAccessories || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/eyeAccessories.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.eyeAccessories = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchEyeAccessories()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.eyeAccessory && selectors.eyeAccessory.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading eye accessories...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="eyeAccessories"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="eyeAccessory in currentPageEyeAccessories"
                                              :key="eyeAccessory.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.eyeAccessory = eyeAccessory; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${eyeAccessory.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- End Accessories selector -->

                          <!-- Start Equipment selector -->
                          <div>
                            <p class="text-lg font-bold">Equipment</p>

                            <div
                              class="grid grid-cols-2 gap-4 bg-slate-300 p-4 rounded-md"
                            >
                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="hat"
                                    class="block text-md font-medium text-slate-800"
                                    >Hat</label
                                  >

                                  <template
                                    x-if="selectors.hat !== defaultSelectors.hat"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('hat')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.hats && Math.ceil(this.hats.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const hatsEl = document.getElementById('hats')
                                    hatsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const hatsEl = document.getElementById('hats')
                                    hatsEl.scrollTo(0, 0)
                                  },
                                  get currentPageHats() {
                                    if (!this.hats) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.hats.slice(start, end)
                                  },
                                  hats: null,
                                  isLoading: false,
                                  async fetchHats() {
                                    if (this.hats || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/hats.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.hats = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchHats()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.hat && selectors.hat.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading hats...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="hats"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="hat in currentPageHats"
                                              :key="hat.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.hat = hat; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${hat.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="earrings"
                                    class="block text-md font-medium text-slate-800"
                                    >Earrings</label
                                  >

                                  <template
                                    x-if="selectors.earrings !== defaultSelectors.earrings"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('earrings')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.hats && Math.ceil(this.hats.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const hatsEl = document.getElementById('hats')
                                    hatsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const hatsEl = document.getElementById('hats')
                                    hatsEl.scrollTo(0, 0)
                                  },
                                  get currentPageEarrings() {
                                    if (!this.earrings) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.earrings.slice(start, end)
                                  },
                                  earrings: null,
                                  isLoading: false,
                                  async fetchEarrings() {
                                    if (this.earrings || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/earrings.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.earrings = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchEarrings()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.earrings && selectors.earrings.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading earrings...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="earrings"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="earring in currentPageEarrings"
                                              :key="earring.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.earrings = earring; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${earring.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="top"
                                    class="block text-md font-medium text-slate-800"
                                    >Top</label
                                  >

                                  <template
                                    x-if="selectors.top !== defaultSelectors.top"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('top')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.tops && Math.ceil(this.tops.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const topsEl = document.getElementById('tops')
                                    topsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const topsEl = document.getElementById('tops')
                                    topsEl.scrollTo(0, 0)
                                  },
                                  get currentPageTops() {
                                    if (!this.tops) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.tops.slice(start, end)
                                  },
                                  tops: null,
                                  isLoading: false,
                                  async fetchTops() {
                                    if (this.tops || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/tops.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.tops = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchTops()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.top && selectors.top.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading tops...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="tops"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="top in currentPageTops"
                                              :key="top.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.top = top; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${top.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="bottom"
                                    class="block text-md font-medium text-slate-800"
                                    >Bottom</label
                                  >

                                  <template
                                    x-if="selectors.bottom !== defaultSelectors.bottom"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('bottom')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.bottoms && Math.ceil(this.bottoms.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const bottomsEl = document.getElementById('bottoms')
                                    bottomsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const bottomsEl = document.getElementById('bottoms')
                                    bottomsEl.scrollTo(0, 0)
                                  },
                                  get currentPageBottoms() {
                                    if (!this.bottoms) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.bottoms.slice(start, end)
                                  },
                                  bottoms: null,
                                  isLoading: false,
                                  async fetchBottoms() {
                                    if (this.bottoms || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/bottoms.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.bottoms = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchBottoms()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.bottom && selectors.bottom.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading bottoms...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="bottoms"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="bottom in currentPageBottoms"
                                              :key="bottom.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.bottom = bottom; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${bottom.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="overall"
                                    class="block text-md font-medium text-slate-800"
                                    >Overall</label
                                  >

                                  <template
                                    x-if="selectors.overall !== defaultSelectors.overall"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('overall')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.overalls && Math.ceil(this.overalls.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const overallsEl = document.getElementById('overalls')
                                    overallsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const overallsEl = document.getElementById('overalls')
                                    overallsEl.scrollTo(0, 0)
                                  },
                                  get currentPageOveralls() {
                                    if (!this.overalls) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.overalls.slice(start, end)
                                  },
                                  overalls: null,
                                  isLoading: false,
                                  async fetchOveralls() {
                                    if (this.overalls || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/overalls.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.overalls = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchOveralls()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.overall && selectors.overall.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading overalls...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="overalls"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="overall in currentPageOveralls"
                                              :key="overall.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.overall = overall; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${overall.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="gloves"
                                    class="block text-md font-medium text-slate-800"
                                    >Gloves</label
                                  >

                                  <template
                                    x-if="selectors.gloves !== defaultSelectors.gloves"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('gloves')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.gloves && Math.ceil(this.gloves.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const glovesEl = document.getElementById('gloves')
                                    glovesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const glovesEl = document.getElementById('gloves')
                                    glovesEl.scrollTo(0, 0)
                                  },
                                  get currentPageGloves() {
                                    if (!this.gloves) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.gloves.slice(start, end)
                                  },
                                  gloves: null,
                                  isLoading: false,
                                  async fetchGloves() {
                                    if (this.gloves || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/gloves.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.gloves = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchGloves()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.gloves && selectors.gloves.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading gloves...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="gloves"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="glove in currentPageGloves"
                                              :key="glove.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.gloves = glove; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${glove.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="weapon"
                                    class="block text-md font-medium text-slate-800"
                                    >Weapon</label
                                  >

                                  <template
                                    x-if="selectors.weapon !== defaultSelectors.weapon"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('weapon')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.weapons && Math.ceil(this.weapons.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const weaponsEl = document.getElementById('weapons')
                                    weaponsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const weaponsEl = document.getElementById('weapons')
                                    weaponsEl.scrollTo(0, 0)
                                  },
                                  get currentPageWeapons() {
                                    if (!this.weapons) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.weapons.slice(start, end)
                                  },
                                  weapons: null,
                                  isLoading: false,
                                  async fetchWeapons() {
                                    if (this.weapons || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/weapons.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.weapons = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchWeapons()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.weapon && selectors.weapon.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading weapons...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="weapons"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="weapon in currentPageWeapons"
                                              :key="weapon.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.weapon = weapon; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${weapon.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>
                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="shield"
                                    class="block text-md font-medium text-slate-800"
                                    >Shield</label
                                  >

                                  <template
                                    x-if="selectors.shield !== defaultSelectors.shield"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('shield')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.shields && Math.ceil(this.shields.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const shieldsEl = document.getElementById('shields')
                                    shieldsEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const shieldsEl = document.getElementById('shields')
                                    shieldsEl.scrollTo(0, 0)
                                  },
                                  get currentPageShields() {
                                    if (!this.shields) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.shields.slice(start, end)
                                  },
                                  shields: null,
                                  isLoading: false,
                                  async fetchShields() {
                                    if (this.shields || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/shields.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.shields = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchShields()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.shield && selectors.shield.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading shields...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="shields"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="shield in currentPageShields"
                                              :key="shield.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.shield = shield; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${shield.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="cape"
                                    class="block text-md font-medium text-slate-800"
                                    >Cape</label
                                  >

                                  <template
                                    x-if="selectors.cape !== defaultSelectors.cape"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('cape')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.capes && Math.ceil(this.capes.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const capesEl = document.getElementById('capes')
                                    capesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const capesEl = document.getElementById('capes')
                                    capesEl.scrollTo(0, 0)
                                  },
                                  get currentPageCapes() {
                                    if (!this.capes) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.capes.slice(start, end)
                                  },
                                  capes: null,
                                  isLoading: false,
                                  async fetchCapes() {
                                    if (this.capes || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/capes.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.capes = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchCapes()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.cape && selectors.cape.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute left-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading capes...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="capes"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="cape in currentPageCapes"
                                              :key="cape.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.cape = cape; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${cape.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="">
                                <div class="flex justify-between">
                                  <label
                                    for="shoes"
                                    class="block text-md font-medium text-slate-800"
                                    >Shoes</label
                                  >

                                  <template
                                    x-if="selectors.shoes !== defaultSelectors.shoes"
                                  >
                                    <button
                                      class="ml-4 inline-flex items-center rounded-full bg-red px-2 py-1 text-sm font-medium leading-5 bg-red-600 text-white shadow-sm hover:bg-red-700"
                                      @click="handleRemoveItem('shoes')"
                                    >
                                      <svg
                                        class="h-4 w-4"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                        viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg"
                                        aria-hidden="true"
                                      >
                                        <path
                                          stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"
                                        ></path>
                                      </svg>
                                    </button>
                                  </template>
                                </div>

                                <div
                                  x-data="{
                                  open: false,
                                  page: 0,
                                  get hasPreviousPage() {
                                    return this.page > 0
                                  },
                                  get hasNextPage() {
                                    return this.shoes && Math.ceil(this.shoes.length / itemsPerPage) > this.page + 1
                                  },
                                  previousPage() {
                                    if (!this.hasPreviousPage) return
                                    this.page = this.page - 1
                                    const shoesEl = document.getElementById('shoes')
                                    shoesEl.scrollTo(0, 0)
                                  },
                                  nextPage() {
                                    if (!this.hasNextPage) return
                                    this.page = this.page + 1
                                    const shoesEl = document.getElementById('shoes')
                                    shoesEl.scrollTo(0, 0)
                                  },
                                  get currentPageShoes() {
                                    if (!this.shoes) return
                                    const start = this.page * itemsPerPage
                                    const end = start + itemsPerPage
                                    return this.shoes.slice(start, end)
                                  },
                                  shoes: null,
                                  isLoading: false,
                                  async fetchShoes() {
                                    if (this.shoes || !this.open) return

                                    this.isLoading = true

                                    const res = await fetch(
                                      '/assets/shoes.json',
                                      {
                                        headers: {
                                          Accept: 'application/json',
                                          'Content-Type': 'application/json',
                                        },
                                      },
                                    )

                                    const json = await res.json()

                                    this.shoes = json
                                    this.isLoading = false
                                  }
                                }"
                                  @keydown.escape.stop="open = false;"
                                  @click.away="open = false;"
                                  class="relative inline-block text-left w-full"
                                  x-effect="fetchShoes()"
                                >
                                  <button
                                    type="button"
                                    class="inline-flex mt-1 w-full rounded-md border-2 border-gray-300 bg-white py-2 px-3 text-left text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm"
                                    id="menu-button"
                                    x-ref="button"
                                    @click="open = true;"
                                    @keyup.space.prevent="open = true;"
                                    @keydown.enter.prevent="open = true;"
                                    aria-expanded="true"
                                    aria-haspopup="true"
                                    x-bind:aria-expanded="open.toString()"
                                    x-text="selectors.shoes && selectors.shoes.name || 'None'"
                                  ></button>

                                  <div
                                    x-show="open"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                    class="absolute right-0 z-10 mt-2 w-80 md:w-96 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                    x-ref="menu-items"
                                    role="menu"
                                    aria-orientation="vertical"
                                    aria-labelledby="menu-button"
                                    tabindex="-1"
                                    @keydown.tab="open = false"
                                    @keydown.enter.prevent="open = false;"
                                    @keyup.space.prevent="open = false;"
                                  >
                                    <div class="p-2 w-full" role="none">
                                      <template x-if="isLoading">
                                        <p>Loading shoes...</p>
                                      </template>

                                      <div>
                                        <template x-if="!isLoading">
                                          <div
                                            id="shoes"
                                            class="h-[300px] overflow-y-scroll grid grid-cols-5 gap-0"
                                          >
                                            <template
                                              x-for="shoe in currentPageShoes"
                                              :key="shoe.itemId"
                                            >
                                              <div
                                                class="rounded-md py-2 px-1.5 cursor-pointer hover:bg-slate-100 flex justify-center max-h-10"
                                                @click="selectors.shoes = shoe; fetchCharacterPreview();"
                                              >
                                                <img
                                                  crossorigin="anonymous"
                                                  :src="`https://api.maplestory.net/item/${shoe.itemId}/iconRaw`"
                                                  loading="lazy"
                                                />
                                              </div>
                                            </template>
                                          </div>
                                        </template>

                                        <nav
                                          class="flex items-center justify-between border-t border-gray-200 px-4 sm:px-0"
                                        >
                                          <div class="-mt-px flex w-0 flex-1">
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="previousPage()"
                                              :disabled="!hasPreviousPage"
                                            >
                                              <svg
                                                class="mr-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-left"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                              Previous
                                            </button>
                                          </div>
                                          <div class="flex -mt-px">
                                            <p
                                              class="inline-flex items-center border-t-2 border-blue-500 px-4 pt-4 text-sm font-medium text-blue-600"
                                              aria-current="page"
                                              x-text="page + 1"
                                            ></p>
                                          </div>
                                          <div
                                            class="-mt-px flex w-0 flex-1 justify-end"
                                          >
                                            <button
                                              class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-blue-500 hover:border-blue-300 hover:text-blue-700 disabled:text-gray-500"
                                              @click="nextPage()"
                                              :disabled="!hasNextPage"
                                            >
                                              Next
                                              <svg
                                                class="ml-3 h-5 w-5 text-gray-400"
                                                x-description="Heroicon name: mini/arrow-long-right"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                                aria-hidden="true"
                                              >
                                                <path
                                                  fill-rule="evenodd"
                                                  d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z"
                                                  clip-rule="evenodd"
                                                ></path>
                                              </svg>
                                            </button>
                                          </div>
                                        </nav>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- End Equipment selector -->
                        </div>
                        <!-- End selectors -->
                      </div>
                      <!-- End character customizer content -->
                    </div>

                    <div class="flex flex-shrink-0 justify-end px-4 py-4">
                      <button
                        type="button"
                        class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                        @click="closeCharacterMenu()"
                        :disabled="isSaving"
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        class="ml-4 inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                        @click="saveCharacter(selectors)"
                        :disabled="isSaving"
                      >
                        Save
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End customize character sidebar -->
    </nav>

    <main
      class="h-full flex justify-between portrait:flex-col landscape:flex-row gap-4 px-4 py-2"
      x-data="{ ...messageData }"
    >
      <!-- Start game -->
      <canvas
        class="block aspect-square portrait:fixed portrait:w-screen portrait:left-0 landscape:h-[70%]"
        id="canvas"
        width="400"
        height="400"
      ></canvas>
      <!-- End game -->

      <!-- container for both chat text and message box -->
      <div class="flex flex-col landscape:h-[70%] lanscape:grow">
        <!-- Start chat/rooms list -->
        <!-- flex-col-reverse makes div scroll to bottom by default -->
        <div
          class="flex flex-col-reverse box-border"
          :class="{ 'overflow-auto': !messageMenuOpen, 'overflow-hidden': messageMenuOpen }"
          id="view"
        ></div>
        <!-- End chat/rooms list -->

        <!-- Start message input row -->
        <footer id="message_form" class="flex items-end gap-x-2 portrait:mb-4">
          <div
            id="message_menu"
            @keydown.escape.stop="handleCloseMenu();"
            class="absolute inline-block text-left"
          >
            <div
              @click.outside="handleCloseMenu();"
              x-show="messageMenuOpen"
              x-transition:enter="transition ease-out duration-100"
              x-transition:enter-start="transform opacity-0 scale-95"
              x-transition:enter-end="transform opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-75"
              x-transition:leave-start="transform opacity-100 scale-100"
              x-transition:leave-end="transform opacity-0 scale-95"
              class="absolute right-0 z-10 mt-2 w-fit origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
              role="menu"
              aria-orientation="vertical"
              tabindex="-1"
              @keydown.tab="messageMenuOpen = false"
              @keydown.enter.prevent="handleCloseMenu();"
              @keyup.space.prevent="handleCloseMenu();"
            >
              <div class="py-1" role="none">
                <button
                  class="text-gray-700 group flex items-center px-4 py-2 text-sm"
                  role="menuitem"
                  tabindex="-1"
                  @click="handleReply();"
                >
                  <svg
                    class="mr-3 min-h-[20px] min-w-[20px] text-gray-400 group-hover:text-gray-500"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"
                    ></path>
                  </svg>
                  Reply
                </button>
              </div>
            </div>
          </div>

          <div class="w-full justify-self-end flex items-end gap-x-2">
            <div class="w-full min-w-0">
              <template x-if="replyingToMessage">
                <div
                  x-data="{
                      get senderName() {
                        const roomId = replyingToMessage['event']['room_id'];
                        const senderId = replyingToMessage['event']['sender'];
                        const members = roomList.get(roomId).getMembers();
                        const senderName = members.filter((member) => member.userId === senderId)[0].rawDisplayName;
                        return senderName;
                      },
                      get messageContent() {
                        const isReply = replyingToMessage.event.content?.['m.relates_to']?.['m.in_reply_to'];
                        const msg = replyingToMessage.event.content.body;
                        if (isReply) {
                          // remove matrix part of who you're replying to
                          // (e.g. '> <@user:matrix.org> ')
                          return msg.replace(/> <[^>]+>\s?/, '')
                        }
                        return msg;
                      },
                      get messageImg() {
                        if (replyingToMessage.event.content.msgtype === 'm.image') {
                      return client.mxcUrlToHttp(replyingToMessage.event.content.url)
                        }
                        return undefined;
                      }
                    }"
                  id="replying_to_message"
                  class="flex items-center divide-x gap-x-2 px-2.5 py-1 border-x border-t rounded-tl-md rounded-tr-md w-full"
                >
                  <svg
                    class="h-5 w-5 min-h-[20px] min-w-[20px] text-gray-400 group-hover:text-gray-500"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"
                    ></path>
                  </svg>

                  <div
                    class="flex items-center pl-2 w-[calc(100%-30px)] justify-between"
                  >
                    <div class="flex items-center min-w-0">
                      <template x-if="messageImg">
                        <img
                          alt=""
                          :src="messageImg"
                          class="w-8 h-8 object-cover mr-2"
                        />
                      </template>

                      <div class="flex flex-col min-w-0">
                        <p x-text="senderName" class="font-bold"></p>
                        <p
                          x-text="messageContent"
                          class="truncate max-w-full"
                        ></p>
                      </div>
                    </div>

                    <button
                      class="rounded-full text-white"
                      @click="handleUnselectReply();"
                    >
                      <svg
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true"
                        class="min-h-[32px] min-w-[32px] stroke-blue-500"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                    </button>
                  </div>
                </div>
              </template>

              <div
                id="chat_input"
                role="textbox"
                contenteditable
                data-placeholder="Message"
                class="block resize-none min-h-[32px] px-2.5 py-0.5 border overflow-hidden outline-none w-full"
                :class="{ 'border rounded-md': !replyingToMessage, 'border-x border-b rounded-br-md rounded-bl-md': replyingToMessage }"
                tabindex="0"
                x-on:keydown="handleSendMessage(event);"
              ></div>
            </div>

            <button
              class="rounded-full bg-blue-600 text-white min-w-[32px] min-h-[32px] p-2"
              @click="handleSendMessage();"
            >
              <svg
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
                className="h-6 w-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75"
                ></path>
              </svg>
            </button>
          </div>
        </footer>
        <!-- End message input row -->
      </div>

      <dialog id="uploadImageDialog">
        <form method="dialog" onsubmit="sendImageMessage(event)">
          <strong> Send an image </strong>
          <div>
            <img id="uploadPreview" />
          </div>
          <div>
            <button
              value="cancel"
              type="button"
              onclick="document.getElementById('uploadImageDialog').close()"
            >
              Cancel
            </button>
            <button id="confirmBtn" type="submit">Send</button>
          </div>
        </form>
      </dialog>

      <!-- End matrix -->
    </main>
  </body>
</html>
